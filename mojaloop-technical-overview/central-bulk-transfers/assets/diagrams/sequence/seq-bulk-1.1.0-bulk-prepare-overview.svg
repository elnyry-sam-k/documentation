<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2707px" preserveAspectRatio="none" style="width:2402px;height:2707px;" version="1.1" viewBox="0 0 2402 2707" width="2402px" zoomAndPan="magnify"><defs><filter height="300%" id="fpo7j6kx854ky" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="437" x="983.5" y="23.5352">1.1.0. DFSP1 sends a Bulk Prepare Transfer request to DFSP2</text><rect fill="#D3D3D3" height="2662.5078" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#ADD8E6" height="2662.5078" style="stroke: #A80036; stroke-width: 1.0;" width="405" x="286.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="410.5" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="2662.5078" style="stroke: #A80036; stroke-width: 1.0;" width="1681.5" x="693.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="1483.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="655.8691" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="1014.2344"/><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="2420.2441" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="613.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="117.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="893.5" y="1523.2402"/><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="2420.2441" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1095.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="2420.2441" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1415.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="2420.2441" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1744.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="2420.2441" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2073.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="2406.2441" style="stroke: #000000; stroke-width: 2.0;" width="2358" x="33" y="170.7754"/><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="1336.5" x="1044.5" y="1800.3457"/><rect fill="#FFFFFF" height="44.2656" style="stroke: none; stroke-width: 1.0;" width="1336.5" x="1044.5" y="1846.9668"/><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="635" x="1352" y="2020.4746"/><rect fill="#FFFFFF" height="44.2656" style="stroke: none; stroke-width: 1.0;" width="635" x="1352" y="2067.0957"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="153.7754" y2="2594.0195"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="153.7754" y2="2594.0195"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="153.7754" y2="2594.0195"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="618.5" x2="618.5" y1="153.7754" y2="2594.0195"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="764.5" x2="764.5" y1="153.7754" y2="2594.0195"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="898.5" x2="898.5" y1="153.7754" y2="2594.0195"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1100.5" x2="1100.5" y1="153.7754" y2="2594.0195"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1251.5" x2="1251.5" y1="153.7754" y2="2594.0195"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1420" x2="1420" y1="153.7754" y2="2594.0195"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1580.5" x2="1580.5" y1="153.7754" y2="2594.0195"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1749" x2="1749" y1="153.7754" y2="2594.0195"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1909" x2="1909" y1="153.7754" y2="2594.0195"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2078" x2="2078" y1="153.7754" y2="2594.0195"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2317" x2="2317" y1="153.7754" y2="2594.0195"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="150.8223">Payer</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#fpo7j6kx854ky)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="none" filter="url(#fpo7j6kx854ky)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="2606.5547">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="2623.043">Payer</text><ellipse cx="67.5" cy="2635.9961" fill="#FEFECE" filter="url(#fpo7j6kx854ky)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,2643.9961 L67.5,2670.9961 M54.5,2651.9961 L80.5,2651.9961 M67.5,2670.9961 L54.5,2685.9961 M67.5,2670.9961 L80.5,2685.9961 " fill="none" filter="url(#fpo7j6kx854ky)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="150.8223">Payee</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#fpo7j6kx854ky)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="none" filter="url(#fpo7j6kx854ky)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="2606.5547">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="2623.043">Payee</text><ellipse cx="126.5" cy="2635.9961" fill="#FEFECE" filter="url(#fpo7j6kx854ky)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,2643.9961 L126.5,2670.9961 M113.5,2651.9961 L139.5,2651.9961 M126.5,2670.9961 L113.5,2685.9961 M126.5,2670.9961 L139.5,2685.9961 " fill="none" filter="url(#fpo7j6kx854ky)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="150.8223">ML API Adapter</text><path d="M325,109.2871 L325,133.2871 M325,121.2871 L342,121.2871 " fill="none" filter="url(#fpo7j6kx854ky)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="121.2871" fill="#FEFECE" filter="url(#fpo7j6kx854ky)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="2606.5547">ML API Adapter</text><path d="M325,2613.5078 L325,2637.5078 M325,2625.5078 L342,2625.5078 " fill="none" filter="url(#fpo7j6kx854ky)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="2625.5078" fill="#FEFECE" filter="url(#fpo7j6kx854ky)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="549.5" y="134.334">ML API Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="588.5" y="150.8223">Handler</text><ellipse cx="618.5" cy="104.7988" fill="#FEFECE" filter="url(#fpo7j6kx854ky)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="614.5,92.7988,620.5,87.7988,618.5,92.7988,620.5,97.7988,614.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="549.5" y="2606.5547">ML API Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="588.5" y="2623.043">Handler</text><ellipse cx="618.5" cy="2641.9961" fill="#FEFECE" filter="url(#fpo7j6kx854ky)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="614.5,2629.9961,620.5,2624.9961,618.5,2629.9961,620.5,2634.9961,614.5,2629.9961" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="697.5" y="150.8223">Central Service API</text><path d="M744,109.2871 L744,133.2871 M744,121.2871 L761,121.2871 " fill="none" filter="url(#fpo7j6kx854ky)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="773" cy="121.2871" fill="#FEFECE" filter="url(#fpo7j6kx854ky)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="697.5" y="2606.5547">Central Service API</text><path d="M744,2613.5078 L744,2637.5078 M744,2625.5078 L761,2625.5078 " fill="none" filter="url(#fpo7j6kx854ky)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="773" cy="2625.5078" fill="#FEFECE" filter="url(#fpo7j6kx854ky)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="845.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="841.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="873.5" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="848.5" y="138.8223">bulk-prepare</text><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="845.5" y="2593.0195"/><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="841.5" y="2597.0195"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="873.5" y="2617.5547">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="848.5" y="2634.043">bulk-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="1054.5" y="134.334">Bulk Prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="1070.5" y="150.8223">Handler</text><ellipse cx="1100.5" cy="104.7988" fill="#FEFECE" filter="url(#fpo7j6kx854ky)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1096.5,92.7988,1102.5,87.7988,1100.5,92.7988,1102.5,97.7988,1096.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="1054.5" y="2606.5547">Bulk Prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="1070.5" y="2623.043">Handler</text><ellipse cx="1100.5" cy="2641.9961" fill="#FEFECE" filter="url(#fpo7j6kx854ky)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1096.5,2629.9961,1102.5,2624.9961,1100.5,2629.9961,1102.5,2634.9961,1096.5,2629.9961" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="1186.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="1182.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1226.5" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="1189.5" y="138.8223">transfer-prepare</text><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="1186.5" y="2593.0195"/><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="1182.5" y="2597.0195"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1226.5" y="2617.5547">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="1189.5" y="2634.043">transfer-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="1362" y="150.8223">Prepare Handler</text><ellipse cx="1420.5" cy="121.2871" fill="#FEFECE" filter="url(#fpo7j6kx854ky)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1416.5,109.2871,1422.5,104.2871,1420.5,109.2871,1422.5,114.2871,1416.5,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="1362" y="2606.5547">Prepare Handler</text><ellipse cx="1420.5" cy="2625.5078" fill="#FEFECE" filter="url(#fpo7j6kx854ky)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1416.5,2613.5078,1422.5,2608.5078,1420.5,2613.5078,1422.5,2618.5078,1416.5,2613.5078" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="1514.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="1510.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1555.5" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="1517.5" y="138.8223">transfer-position</text><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="1514.5" y="2593.0195"/><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="1510.5" y="2597.0195"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1555.5" y="2617.5547">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="1517.5" y="2634.043">transfer-position</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1690" y="150.8223">Position Handler</text><ellipse cx="1749.5" cy="121.2871" fill="#FEFECE" filter="url(#fpo7j6kx854ky)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1745.5,109.2871,1751.5,104.2871,1749.5,109.2871,1751.5,114.2871,1745.5,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1690" y="2606.5547">Position Handler</text><ellipse cx="1749.5" cy="2625.5078" fill="#FEFECE" filter="url(#fpo7j6kx854ky)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1745.5,2613.5078,1751.5,2608.5078,1749.5,2613.5078,1751.5,2618.5078,1745.5,2613.5078" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1846" y="97.7988"/><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1842" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1884.5" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1849" y="138.8223">bulk-processing</text><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1846" y="2593.0195"/><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1842" y="2597.0195"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1884.5" y="2617.5547">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1849" y="2634.043">bulk-processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="2022" y="134.334">Bulk Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="2048.5" y="150.8223">Handler</text><ellipse cx="2078.5" cy="104.7988" fill="#FEFECE" filter="url(#fpo7j6kx854ky)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2074.5,92.7988,2080.5,87.7988,2078.5,92.7988,2080.5,97.7988,2074.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="2022" y="2606.5547">Bulk Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="2048.5" y="2623.043">Handler</text><ellipse cx="2078.5" cy="2641.9961" fill="#FEFECE" filter="url(#fpo7j6kx854ky)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2074.5,2629.9961,2080.5,2624.9961,2078.5,2629.9961,2080.5,2634.9961,2074.5,2629.9961" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="2268" y="97.7988"/><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="2264" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2292.5" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="2271" y="138.8223">notifications</text><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="2268" y="2593.0195"/><rect fill="#FEFECE" filter="url(#fpo7j6kx854ky)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="2264" y="2597.0195"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2292.5" y="2617.5547">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="2271" y="2634.043">notifications</text><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="655.8691" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="1014.2344"/><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="2420.2441" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="613.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="117.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="893.5" y="1523.2402"/><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="2420.2441" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1095.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="2420.2441" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1415.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="2420.2441" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1744.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="2420.2441" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2073.5" y="163.7754"/><path d="M33,170.7754 L445,170.7754 L445,177.7754 L435,187.7754 L33,187.7754 L33,170.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2406.2441" style="stroke: #000000; stroke-width: 2.0;" width="2358" x="33" y="170.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="367" x="48" y="184.3438">DFSP1 sends a Bulk Prepare Transfer request to DFSP2</text><path d="M72,193.0859 L72,983.0859 L413,983.0859 L413,203.0859 L403,193.0859 L72,193.0859 " fill="#FFFF00" filter="url(#fpo7j6kx854ky)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M403,193.0859 L403,203.0859 L413,203.0859 L403,193.0859 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="78" y="210.6543">Headers - bulkTransferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="94" y="225.9648">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="94" y="241.2754">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="94" y="256.5859">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="94" y="271.8965">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="94" y="287.207">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="94" y="302.5176">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="94" y="317.8281">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="94" y="333.1387">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="94" y="348.4492">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="94" y="363.7598">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="379.0703">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="82" y="394.3809"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="78" y="409.6914">Payload - bulkTransferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="425.002">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="94" y="440.3125">"bulkTransferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="94" y="455.623">"bulkQuoteId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="94" y="470.9336">"payeeFsp": &lt;fspID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="94" y="486.2441">"payerFsp": &lt;fspID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="94" y="501.5547">"individualTransfers":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="94" y="516.8652">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="532.1758">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="126" y="547.4863">"transferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="126" y="562.7969">"transferAmount":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="578.1074">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="142" y="593.418">"currency": &lt;currency&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="142" y="608.7285">"amount": &lt;amount&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="126" y="624.0391">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="126" y="639.3496">"ilpPacket": &lt;ilpPacket&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="126" y="654.6602">"condition": &lt;ilpCondition&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="126" y="669.9707">"extensionList":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="685.2813">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="142" y="700.5918">"extension":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="142" y="715.9023">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="158" y="731.2129">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="174" y="746.5234">“key”: &lt;key&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="174" y="761.834">“value”: &lt;value&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="158" y="777.1445">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="142" y="792.4551">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="807.7656">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="823.0762">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="94" y="838.3867">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="94" y="853.6973">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="110" y="869.0078">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="884.3184">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="142" y="899.6289">“key”: &lt;key&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="142" y="914.9395">“value”: &lt;value&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="930.25">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="945.5605">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="94" y="960.8711">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="976.1816">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="338.5" x2="328.5" y1="1014.2344" y2="1010.2344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="338.5" x2="328.5" y1="1014.2344" y2="1018.2344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="339.5" y1="1014.2344" y2="1014.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="74.5" y="1009.4922">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="87.5" y="1009.4922">POST - /bulkTransfers</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="392.5" y1="1074.166" y2="1074.166"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="392.5" x2="392.5" y1="1074.166" y2="1087.166"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="351.5" x2="392.5" y1="1087.166" y2="1087.166"/><polygon fill="#A80036" points="361.5,1083.166,351.5,1087.166,361.5,1091.166,357.5,1087.166" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="1054.1133">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="370.5" y="1038.8027">Validate incoming message and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="370.5" y="1054.1133">originator matching Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="370.5" y="1069.4238">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="454.5" y="1069.4238">3000-3002, 3100-3107</text><path d="M355,1100.166 L355,1462.166 L648,1462.166 L648,1110.166 L638,1100.166 L355,1100.166 " fill="#FFFF00" filter="url(#fpo7j6kx854ky)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M638,1100.166 L638,1110.166 L648,1110.166 L638,1100.166 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="361" y="1117.7344">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="1133.0449">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="377" y="1148.3555">id: &lt;bulkTransferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="377" y="1163.666">from: &lt;bulkTransferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="377" y="1178.9766">to: &lt;bulkTransferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="377" y="1194.2871">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="377" y="1209.5977">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="393" y="1224.9082">headers: &lt;bulkTransferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="393" y="1240.2188">payload: &lt;bulkTransferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="1255.5293">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="377" y="1270.8398">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="393" y="1286.1504">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="409" y="1301.4609">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="409" y="1316.7715">type: bulk-prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="409" y="1332.082">action: bulk-prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="409" y="1347.3926">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="409" y="1362.7031">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="425" y="1378.0137">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="1393.3242">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="1408.6348">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="1423.9453">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="377" y="1439.2559">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="1454.5664">}</text><polygon fill="#A80036" points="881.5,1519.2402,891.5,1523.2402,881.5,1527.2402,885.5,1523.2402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="887.5" y1="1523.2402" y2="1523.2402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="1503.1875">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="370.5" y="1487.877">Route &amp; Publish Bulk Prepare event</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="370.5" y="1503.1875">for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="370.5" y="1518.498">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="447.5" y="1518.498">2003</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="903.5" x2="945.5" y1="1583.1719" y2="1583.1719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="945.5" x2="945.5" y1="1583.1719" y2="1596.1719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="904.5" x2="945.5" y1="1596.1719" y2="1596.1719"/><polygon fill="#A80036" points="914.5,1592.1719,904.5,1596.1719,914.5,1600.1719,910.5,1596.1719" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="910.5" y="1563.1191">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="923.5" y="1547.8086">Ensure event is replicated</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="923.5" y="1563.1191">as configured (ACKS=all)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="923.5" y="1578.4297">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="1000.5" y="1578.4297">2003</text><polygon fill="#A80036" points="361.5,1636.793,351.5,1640.793,361.5,1644.793,357.5,1640.793" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="355.5" x2="897.5" y1="1640.793" y2="1640.793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="1628.3955">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="380.5" y="1620.7402">Respond replication acknowledgements</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="380.5" y="1636.0508">have been received</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="77.5" y1="1670.1035" y2="1666.1035"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="77.5" y1="1670.1035" y2="1674.1035"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="67.5" x2="344.5" y1="1670.1035" y2="1670.1035"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="84.5" y="1665.3613">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="97.5" y="1665.3613">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="909.5,1720.4141,899.5,1724.4141,909.5,1728.4141,905.5,1724.4141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="903.5" x2="1094.5" y1="1724.4141" y2="1724.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="915.5" y="1719.6719">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="928.5" y="1719.6719">Consume message</text><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="481" x="838.5" y="1732.4141"/><polygon fill="#EEEEEE" points="838.5,1732.4141,902.5,1732.4141,902.5,1739.4141,892.5,1749.4141,838.5,1749.4141,838.5,1732.4141" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="851.5" y="1746.9824">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="982.5" y="1765.9824">Bulk Prepare Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="986.5" y="1781.293"/><path d="M1044.5,1800.3457 L1106.5,1800.3457 L1106.5,1807.3457 L1096.5,1817.3457 L1044.5,1817.3457 L1044.5,1800.3457 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="1336.5" x="1044.5" y="1800.3457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="1059.5" y="1813.9141">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51" x="1121.5" y="1812.9805">[Success]</text><polygon fill="#A80036" points="1239.5,1834.9668,1249.5,1838.9668,1239.5,1842.9668,1243.5,1838.9668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1105.5" x2="1245.5" y1="1838.9668" y2="1838.9668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1112.5" y="1834.2246">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1125.5" y="1834.2246">Produce message</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1044.5" x2="2381" y1="1847.9668" y2="1847.9668"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="1049.5" y="1858.6016">[Failure]</text><polygon fill="#A80036" points="2305.5,1879.2324,2315.5,1883.2324,2305.5,1887.2324,2309.5,1883.2324" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1105.5" x2="2311.5" y1="1883.2324" y2="1883.2324"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1112.5" y="1878.4902">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1125.5" y="1878.4902">Produce message</text><polygon fill="#A80036" points="1262.5,1940.543,1252.5,1944.543,1262.5,1948.543,1258.5,1944.543" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1256.5" x2="1414.5" y1="1944.543" y2="1944.543"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1268.5" y="1939.8008">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1290.5" y="1939.8008">Consume message</text><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="470" x="1179.5" y="1952.543"/><polygon fill="#EEEEEE" points="1179.5,1952.543,1243.5,1952.543,1243.5,1959.543,1233.5,1969.543,1179.5,1969.543,1179.5,1952.543" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1192.5" y="1967.1113">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1335.5" y="1986.1113">Prepare Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1339.5" y="2001.4219"/><path d="M1352,2020.4746 L1414,2020.4746 L1414,2027.4746 L1404,2037.4746 L1352,2037.4746 L1352,2020.4746 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="635" x="1352" y="2020.4746"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="1367" y="2034.043">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51" x="1429" y="2033.1094">[Success]</text><polygon fill="#A80036" points="1568.5,2055.0957,1578.5,2059.0957,1568.5,2063.0957,1572.5,2059.0957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1425.5" x2="1574.5" y1="2059.0957" y2="2059.0957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1432.5" y="2054.3535">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1454.5" y="2054.3535">Produce message</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1352" x2="1987" y1="2068.0957" y2="2068.0957"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="1357" y="2078.7305">[Failure]</text><polygon fill="#A80036" points="1897.5,2099.3613,1907.5,2103.3613,1897.5,2107.3613,1901.5,2103.3613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1425.5" x2="1903.5" y1="2103.3613" y2="2103.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1432.5" y="2098.6191">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1454.5" y="2098.6191">Produce message</text><polygon fill="#A80036" points="1591.5,2160.6719,1581.5,2164.6719,1591.5,2168.6719,1587.5,2164.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1585.5" x2="1743.5" y1="2164.6719" y2="2164.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1597.5" y="2159.9297">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1619.5" y="2159.9297">Consume message</text><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="468.5" x="1507.5" y="2172.6719"/><polygon fill="#EEEEEE" points="1507.5,2172.6719,1571.5,2172.6719,1571.5,2179.6719,1561.5,2189.6719,1507.5,2189.6719,1507.5,2172.6719" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1520.5" y="2187.2402">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1660.25" y="2206.2402">Position Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1664.25" y="2221.5508"/><polygon fill="#A80036" points="1897.5,2250.9141,1907.5,2254.9141,1897.5,2258.9141,1901.5,2254.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1754.5" x2="1903.5" y1="2254.9141" y2="2254.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1761.5" y="2250.1719">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1783.5" y="2250.1719">Produce message</text><polygon fill="#A80036" points="1920.5,2305.2246,1910.5,2309.2246,1920.5,2313.2246,1916.5,2309.2246" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1914.5" x2="2072.5" y1="2309.2246" y2="2309.2246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1926.5" y="2304.4824">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1948.5" y="2304.4824">Consume message</text><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="531" x="1839" y="2317.2246"/><polygon fill="#EEEEEE" points="1839,2317.2246,1903,2317.2246,1903,2324.2246,1893,2334.2246,1839,2334.2246,1839,2317.2246" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1852" y="2331.793">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="1997" y="2350.793">Bulk Processing Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="2001" y="2366.1035"/><polygon fill="#A80036" points="2305.5,2395.4668,2315.5,2399.4668,2305.5,2403.4668,2309.5,2399.4668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="2083.5" x2="2311.5" y1="2399.4668" y2="2399.4668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2090.5" y="2394.7246">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="2112.5" y="2394.7246">Send Bulk Prepare notification</text><polygon fill="#A80036" points="2305.5,2449.7773,2315.5,2453.7773,2305.5,2457.7773,2309.5,2453.7773" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="623.5" x2="2311.5" y1="2453.7773" y2="2453.7773"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="630.5" y="2449.0352">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="652.5" y="2449.0352">Consume message</text><rect fill="#FFFFFF" filter="url(#fpo7j6kx854ky)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="2271" x="99" y="2461.7773"/><polygon fill="#EEEEEE" points="99,2461.7773,163,2461.7773,163,2468.7773,153,2478.7773,99,2478.7773,99,2461.7773" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="112" y="2476.3457">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="1115.5" y="2495.3457">Send notification to Participant (Payee)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1119.5" y="2510.6563"/><polygon fill="#A80036" points="137.5,2540.0195,127.5,2544.0195,137.5,2548.0195,133.5,2544.0195" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="131.5" x2="612.5" y1="2544.0195" y2="2544.0195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="143.5" y="2539.2773">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="165.5" y="2539.2773">Send Bulk Prepare notification to Payee</text><!--
@startuml
title 1.1.0. DFSP1 sends a Bulk Prepare Transfer request to DFSP2

autonumber


actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification \nHandler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "topic-\nbulk-prepare" as TOPIC_BULK_PREPARE
control "Bulk Prepare\nHandler" as BULK_PREP_HANDLER
collections "topic-\ntransfer-prepare" as TOPIC_TRANSFER_PREPARE
control "Prepare Handler" as PREP_HANDLER
collections "topic-\ntransfer-position" as TOPIC_TRANSFER_POSITION
control "Position Handler" as POS_HANDLER
collections "topic-\nbulk-processing" as TOPIC_BULK_PROCESSING
control "Bulk Processing\nHandler" as BULK_PROC_HANDLER
collections "topic-\nnotifications" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_BULK_PREPARE
    participant BULK_PREP_HANDLER
    participant TOPIC_TRANSFER_PREPARE
    participant PREP_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant POS_HANDLER
    participant TOPIC_BULK_PROCESSING
    participant BULK_PROC_HANDLER
    participant TOPIC_NOTIFICATIONS
end box

activate NOTIFY_HANDLER
activate BULK_PREP_HANDLER
activate PREP_HANDLER
activate POS_HANDLER
activate BULK_PROC_HANDLER
group DFSP1 sends a Bulk Prepare Transfer request to DFSP2
    note right of DFSP1 #yellow
        Headers - bulkTransferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - bulkTransferMessage:
        {
            "bulkTransferId": <uuid>,
            "bulkQuoteId": <uuid>, 
            "payeeFsp": <fspID>,
            "payerFsp": <fspID>,
            "individualTransfers": 
            [
                {
                    "transferId": <uuid>, 
                    "transferAmount": 
                    { 
                        "currency": <currency>, 
                        "amount": <amount> 
                    }, 
                    "ilpPacket": <ilpPacket>,
                    "condition": <ilpCondition>,
                    "extensionList":
                    {
                        "extension":
                        [ 
                            { 
                                “key”: <key>, 
                                “value”: <value> 
                            }
                        ]
                    }
                }
            ],
            "extensionList": {
                "extension": [
                    {
                        “key”: <key>, 
                        “value”: <value> 
                    }
                ]
            }
        }
    end note
    DFSP1 ->> MLAPI: POST - /bulkTransfers
    activate MLAPI
    MLAPI -> MLAPI: Validate incoming message and \noriginator matching Payer\n<color #FF0000><b>Error codes:</b> 3000-3002, 3100-3107</color>
    note right of MLAPI #yellow
        Message:
        {
            id: <bulkTransferMessage.transferId>
            from: <bulkTransferMessage.payerFsp>,
            to: <bulkTransferMessage.payeeFsp>,
            type: application/json
            content: {
                headers: <bulkTransferHeaders>,
                payload: <bulkTransferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: bulk-prepare,
                    action: bulk-prepare,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_BULK_PREPARE: Route & Publish Bulk Prepare event \nfor Payer\n<color #FF0000><b>Error code:</b> 2003</color>
    activate TOPIC_BULK_PREPARE
    TOPIC_BULK_PREPARE <-> TOPIC_BULK_PREPARE: Ensure event is replicated \nas configured (ACKS=all)\n<color #FF0000><b>Error code:</b> 2003</color>
    TOPIC_BULK_PREPARE - -> MLAPI: Respond replication acknowledgements \nhave been received
    deactivate TOPIC_BULK_PREPARE
    MLAPI - ->> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI
    |||
    TOPIC_BULK_PREPARE <- BULK_PREP_HANDLER: Consume message
    ref over TOPIC_BULK_PREPARE, BULK_PREP_HANDLER, TOPIC_TRANSFER_PREPARE :  Bulk Prepare Handler Consume \n
    alt Success
        BULK_PREP_HANDLER -> TOPIC_TRANSFER_PREPARE: Produce message
    else Failure
        BULK_PREP_HANDLER - -> TOPIC_NOTIFICATIONS: Produce message
    end
    |||
    TOPIC_TRANSFER_PREPARE <- PREP_HANDLER: Consume message
    ref over TOPIC_TRANSFER_PREPARE, PREP_HANDLER, TOPIC_TRANSFER_POSITION :  Prepare Handler Consume\n
    alt Success
        PREP_HANDLER -> TOPIC_TRANSFER_POSITION: Produce message
    else Failure
        PREP_HANDLER - -> TOPIC_BULK_PROCESSING: Produce message
    end
    |||
    TOPIC_TRANSFER_POSITION <- POS_HANDLER: Consume message
    ref over TOPIC_TRANSFER_POSITION, POS_HANDLER, TOPIC_BULK_PROCESSING : Position Handler Consume\n
    POS_HANDLER -> TOPIC_BULK_PROCESSING: Produce message
    |||
    TOPIC_BULK_PROCESSING <- BULK_PROC_HANDLER: Consume message
    ref over TOPIC_BULK_PROCESSING, BULK_PROC_HANDLER, TOPIC_NOTIFICATIONS : Bulk Processing Handler Consume \n
    BULK_PROC_HANDLER - -> TOPIC_NOTIFICATIONS: Send Bulk Prepare notification
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: Consume message
    ref over DFSP2, TOPIC_NOTIFICATIONS : Send notification to Participant (Payee)\n
    NOTIFY_HANDLER -> DFSP2: Send Bulk Prepare notification to Payee
    |||
end
deactivate POS_HANDLER
deactivate BULK_PREP_HANDLER
deactivate PREP_HANDLER
deactivate BULK_PROC_HANDLER
deactivate NOTIFY_HANDLER
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.14.4
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>