<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="4036px" preserveAspectRatio="none" style="width:1692px;height:4036px;" version="1.1" viewBox="0 0 1692 4036" width="1692px" zoomAndPan="magnify"><defs><filter height="300%" id="f14gpz4gt9lwd9" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="249" x="722.5" y="23.5352">2.1.1. Bulk Fulfil Handler Consume</text><rect fill="#FFFFE0" height="3990.9766" style="stroke: #A80036; stroke-width: 1.0;" width="1522" x="19" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="729.5" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="69" y="174.3965"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="3818.7129" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="229" y="128.7754"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="713" y="3315.5957"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="3895.4883"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="167.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1196" y="949.4707"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1196" y="1430.0605"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1196" y="1898.6289"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="152.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1196" y="2127.8027"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1196" y="2386.5527"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1196" y="2750.5898"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1484" y="994.0918"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1484" y="1459.3711"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1484" y="1927.9395"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1484" y="2157.1133"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1484" y="2415.8633"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1484" y="2779.9004"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="3804.7129" style="stroke: #000000; stroke-width: 2.0;" width="1668" x="13" y="135.7754"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="121.5527" style="stroke: #000000; stroke-width: 2.0;" width="413.5" x="177.5" y="219.3965"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="90.2422" style="stroke: #000000; stroke-width: 2.0;" width="393.5" x="187.5" y="243.707"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="826.5" x="187.5" y="354.9492"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="103.2422" style="stroke: #000000; stroke-width: 2.0;" width="978.5" x="187.5" y="526.502"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="1932.6719" style="stroke: #000000; stroke-width: 2.0;" width="1523.5" x="147.5" y="643.7441"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="1197.6426" style="stroke: #000000; stroke-width: 2.0;" width="1503.5" x="157.5" y="837.918"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="823.9844" style="stroke: #000000; stroke-width: 2.0;" width="1464.5" x="167.5" y="1204.5762"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="826.5" x="187.5" y="1228.8867"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="273.75" style="stroke: #000000; stroke-width: 2.0;" width="998.5" x="177.5" y="1566.3027"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="78.2422" style="stroke: #000000; stroke-width: 2.0;" width="978.5" x="187.5" y="1590.6133"/><rect fill="#FFFFFF" height="88.5762" style="stroke: none; stroke-width: 1.0;" width="998.5" x="177.5" y="1675.8555"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="201.5" x="187.5" y="1697.8105"/><rect fill="#FFFFFF" height="75.6211" style="stroke: none; stroke-width: 1.0;" width="998.5" x="177.5" y="1764.4316"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="315.5" x="187.5" y="1773.4316"/><rect fill="#FFFFFF" height="181.5078" style="stroke: none; stroke-width: 1.0;" width="1464.5" x="167.5" y="1847.0527"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="519.8555" style="stroke: #000000; stroke-width: 2.0;" width="1422.5" x="177.5" y="2049.5605"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="214.4844" style="stroke: #000000; stroke-width: 2.0;" width="1402.5" x="187.5" y="2073.8711"/><rect fill="#FFFFFF" height="274.0605" style="stroke: none; stroke-width: 1.0;" width="1422.5" x="177.5" y="2295.3555"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="245.1055" style="stroke: #000000; stroke-width: 2.0;" width="1402.5" x="187.5" y="2317.3105"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="1343.0723" style="stroke: #000000; stroke-width: 2.0;" width="1440.5" x="167.5" y="2590.416"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="681.248" style="stroke: #000000; stroke-width: 2.0;" width="1420.5" x="177.5" y="2672.3477"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="183.8633" style="stroke: #000000; stroke-width: 2.0;" width="1400.5" x="187.5" y="2696.6582"/><rect fill="#FFFFFF" height="572.8926" style="stroke: none; stroke-width: 1.0;" width="1440.5" x="167.5" y="3360.5957"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="74" x2="74" y1="118.7754" y2="3957.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="233.5" x2="233.5" y1="118.7754" y2="3957.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="718" x2="718" y1="118.7754" y2="3957.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="842" x2="842" y1="118.7754" y2="3957.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="953" x2="953" y1="118.7754" y2="3957.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1085" x2="1085" y1="118.7754" y2="3957.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1201" x2="1201" y1="118.7754" y2="3957.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1489" x2="1489" y1="118.7754" y2="3957.4883"/><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="27" y="62.7988"/><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="23" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="30" y="87.334">topic-bulk-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="54.5" y="103.8223">fulfil</text><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="27" y="3956.4883"/><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="23" y="3960.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="30" y="3981.0234">topic-bulk-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="54.5" y="3997.5117">fulfil</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="197.5" y="99.334">Bulk Fulfil</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="204" y="115.8223">Handler</text><ellipse cx="234" cy="69.7988" fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="230,57.7988,236,52.7988,234,57.7988,236,62.7988,230,57.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="197.5" y="3970.0234">Bulk Fulfil</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="204" y="3986.5117">Handler</text><ellipse cx="234" cy="4005.4648" fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="230,3993.4648,236,3988.4648,234,3993.4648,236,3998.4648,230,3993.4648" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="659" y="62.7988"/><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="655" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="662" y="87.334">topic-transfer-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="698.5" y="103.8223">fulfil</text><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="659" y="3956.4883"/><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="655" y="3960.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="662" y="3981.0234">topic-transfer-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="698.5" y="3997.5117">fulfil</text><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="795" y="62.7988"/><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="791" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="798" y="87.334">topic-bulk-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="800.5" y="103.8223">processing</text><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="795" y="3956.4883"/><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="791" y="3960.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="798" y="3981.0234">topic-bulk-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="800.5" y="3997.5117">processing</text><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="907" y="79.2871"/><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="903" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="910" y="103.8223">topic-event</text><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="907" y="3956.4883"/><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="903" y="3960.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="910" y="3981.0234">topic-event</text><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="1018" y="79.2871"/><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="1014" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="1021" y="103.8223">topic-notification</text><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="1018" y="3956.4883"/><rect fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="1014" y="3960.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="1021" y="3981.0234">topic-notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="1166" y="115.8223">Bulk DAO</text><ellipse cx="1201" cy="86.2871" fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1189" x2="1213" y1="100.2871" y2="100.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="1166" y="3970.0234">Bulk DAO</text><ellipse cx="1201" cy="3988.9766" fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1189" x2="1213" y1="4002.9766" y2="4002.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1441" y="115.8223">Central Store</text><path d="M1471,66.2871 C1471,56.2871 1489,56.2871 1489,56.2871 C1489,56.2871 1507,56.2871 1507,66.2871 L1507,92.2871 C1507,102.2871 1489,102.2871 1489,102.2871 C1489,102.2871 1471,102.2871 1471,92.2871 L1471,66.2871 " fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1471,66.2871 C1471,76.2871 1489,76.2871 1489,76.2871 C1489,76.2871 1507,76.2871 1507,66.2871 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1441" y="3970.0234">Central Store</text><path d="M1471,3982.9766 C1471,3972.9766 1489,3972.9766 1489,3972.9766 C1489,3972.9766 1507,3972.9766 1507,3982.9766 L1507,4008.9766 C1507,4018.9766 1489,4018.9766 1489,4018.9766 C1489,4018.9766 1471,4018.9766 1471,4008.9766 L1471,3982.9766 " fill="#FEFECE" filter="url(#f14gpz4gt9lwd9)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1471,3982.9766 C1471,3992.9766 1489,3992.9766 1489,3992.9766 C1489,3992.9766 1507,3992.9766 1507,3982.9766 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="69" y="174.3965"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="3818.7129" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="229" y="128.7754"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="713" y="3315.5957"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="3895.4883"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="167.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1196" y="949.4707"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1196" y="1430.0605"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1196" y="1898.6289"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="152.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1196" y="2127.8027"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1196" y="2386.5527"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1196" y="2750.5898"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1484" y="994.0918"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1484" y="1459.3711"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1484" y="1927.9395"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1484" y="2157.1133"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1484" y="2415.8633"/><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1484" y="2779.9004"/><path d="M13,135.7754 L249,135.7754 L249,142.7754 L239,152.7754 L13,152.7754 L13,135.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3804.7129" style="stroke: #000000; stroke-width: 2.0;" width="1668" x="13" y="135.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="191" x="28" y="149.3438">Bulk Fulfil Handler Consume</text><polygon fill="#A80036" points="90,170.3965,80,174.3965,90,178.3965,86,174.3965" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="84" x2="228" y1="174.3965" y2="174.3965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="96" y="169.6543">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="109" y="169.6543">Consume message</text><path d="M177.5,219.3965 L261.5,219.3965 L261.5,226.3965 L251.5,236.3965 L177.5,236.3965 L177.5,219.3965 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="121.5527" style="stroke: #000000; stroke-width: 2.0;" width="413.5" x="177.5" y="219.3965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="192.5" y="232.9648">break</text><path d="M187.5,243.707 L329.5,243.707 L329.5,250.707 L319.5,260.707 L187.5,260.707 L187.5,243.707 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.2422" style="stroke: #000000; stroke-width: 2.0;" width="393.5" x="187.5" y="243.707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="202.5" y="257.2754">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="281" y1="312.9492" y2="312.9492"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="281" x2="281" y1="312.9492" y2="325.9492"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="281" y1="325.9492" y2="325.9492"/><polygon fill="#A80036" points="250,321.9492,240,325.9492,250,329.9492,246,325.9492" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="246" y="292.8965">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="259" y="277.5859">Validate event - Rule:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="259" y="292.8965">type == 'bulk-fulfil' &amp;&amp; action == 'bulk-commit'</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="259" y="308.207">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="343" y="308.207">2001</text><path d="M187.5,354.9492 L402.5,354.9492 L402.5,361.9492 L392.5,371.9492 L187.5,371.9492 L187.5,354.9492 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="826.5" x="187.5" y="354.9492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="202.5" y="368.5176">Persist Event Information</text><polygon fill="#A80036" points="941.5,414.5703,951.5,418.5703,941.5,422.5703,945.5,418.5703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="947.5" y1="418.5703" y2="418.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="246" y="413.8281">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="259" y="413.8281">Publish event information</text><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="808.5" x="194.5" y="426.5703"/><polygon fill="#EEEEEE" points="194.5,426.5703,258.5,426.5703,258.5,433.5703,248.5,443.5703,194.5,443.5703,194.5,426.5703" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="207.5" y="441.1387">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="523.75" y="460.1387">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="527.75" y="475.4492"/><path d="M187.5,526.502 L409.5,526.502 L409.5,533.502 L399.5,543.502 L187.5,543.502 L187.5,526.502 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="103.2422" style="stroke: #000000; stroke-width: 2.0;" width="978.5" x="187.5" y="526.502"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="202.5" y="540.0703">Validate FSPIOP-Signature</text><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="960.5" x="194.5" y="568.8125"/><polygon fill="#EEEEEE" points="194.5,568.8125,258.5,568.8125,258.5,575.8125,248.5,585.8125,194.5,585.8125,194.5,568.8125" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="207.5" y="583.3809">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="508.75" y="602.3809">Validate message.content.headers.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="726.75" y="602.3809">FSPIOP-Signature</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="508.75" y="617.6914">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="592.75" y="617.6914">3105/3106</text><path d="M147.5,643.7441 L379.5,643.7441 L379.5,650.7441 L369.5,660.7441 L147.5,660.7441 L147.5,643.7441 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1932.6719" style="stroke: #000000; stroke-width: 2.0;" width="1523.5" x="147.5" y="643.7441"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="187" x="162.5" y="657.3125">Validate Bulk Fulfil Transfer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="281" y1="682.3652" y2="682.3652"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="281" x2="281" y1="682.3652" y2="695.3652"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="281" y1="695.3652" y2="695.3652"/><polygon fill="#A80036" points="250,691.3652,240,695.3652,250,699.3652,246,695.3652" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="246" y="677.623">4</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="259" y="677.623">Schema validation of the incoming message</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="281" y1="739.9863" y2="739.9863"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="281" x2="281" y1="739.9863" y2="752.9863"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="281" y1="752.9863" y2="752.9863"/><polygon fill="#A80036" points="250,748.9863,240,752.9863,250,756.9863,246,752.9863" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="246" y="727.5889">5</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="259" y="719.9336">Verify the message's signature</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="259" y="735.2441">(to be confirmed in future requirement)</text><path d="M244,765.9863 L244,820.9863 L609,820.9863 L609,775.9863 L599,765.9863 L244,765.9863 " fill="#D3D3D3" filter="url(#f14gpz4gt9lwd9)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M599,765.9863 L599,775.9863 L609,775.9863 L599,765.9863 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="250" y="783.5547">The above validation steps are already handled by</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="333" x="250" y="798.8652">the ML-Adapter for the open source implementation.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="344" x="250" y="814.1758">It may need to be added in future for custom adapters.</text><path d="M157.5,837.918 L475.5,837.918 L475.5,844.918 L465.5,854.918 L157.5,854.918 L157.5,837.918 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1197.6426" style="stroke: #000000; stroke-width: 2.0;" width="1503.5" x="157.5" y="837.918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="273" x="172.5" y="851.4863">Validate Bulk Fulfilment Duplicate Check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="281" y1="876.5391" y2="876.5391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="281" x2="281" y1="876.5391" y2="889.5391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="281" y1="889.5391" y2="889.5391"/><polygon fill="#A80036" points="250,885.5391,240,889.5391,250,893.5391,246,889.5391" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="246" y="871.7969">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="259" y="871.7969">Generate bulkTransferFulfilmentId UUID</text><polygon fill="#A80036" points="1184,945.4707,1194,949.4707,1184,953.4707,1188,949.4707" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="1190" y1="949.4707" y2="949.4707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="246" y="929.418">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="259" y="914.1074">Request to retrieve Bulk transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="259" y="929.418">fulfilment hashes by bulkTransferId</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="259" y="944.7285">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="336" y="944.7285">2003</text><polygon fill="#A80036" points="1472,990.0918,1482,994.0918,1472,998.0918,1476,994.0918" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1206" x2="1478" y1="994.0918" y2="994.0918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1213" y="981.6943">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="1226" y="974.0391">Request Bulk transfer fulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="1226" y="989.3496">duplicate message hashes</text><polygon fill="#FFFFE0" filter="url(#f14gpz4gt9lwd9)" points="1336,1007.0918,1641,1007.0918,1651,1033.0918,1641,1060.0918,1336,1060.0918,1326,1033.0918,1336,1007.0918" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1338" y="1023.6602">SELET transferId, hash</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1338" y="1038.9707">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="261" x="1378" y="1038.9707">bulkTransferFulfilmentDuplicateCheck</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="1338" y="1054.2813">WHERE bulkTransferId = request.params.id</text><polygon fill="#A80036" points="1217,1083.334,1207,1087.334,1217,1091.334,1213,1087.334" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1211" x2="1488" y1="1087.334" y2="1087.334"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1223" y="1082.5918">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="1236" y="1082.5918">Return existing hashes</text><polygon fill="#A80036" points="250,1112.6445,240,1116.6445,250,1120.6445,246,1116.6445" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="244" x2="1200" y1="1116.6445" y2="1116.6445"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="256" y="1111.9023">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="278" y="1111.9023">Return</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="47" x="323" y="1111.9023">(list of)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="374" y="1111.9023">transfer fulfil message hash(es)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="281" y1="1176.5762" y2="1176.5762"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="281" x2="281" y1="1176.5762" y2="1189.5762"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="281" y1="1189.5762" y2="1189.5762"/><polygon fill="#A80036" points="250,1185.5762,240,1189.5762,250,1193.5762,246,1189.5762" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="246" y="1156.5234">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="268" y="1141.2129">Loop the list of returned hashes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="268" y="1156.5234">and compare each entry with the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="268" y="1171.834">calculated message hash</text><path d="M167.5,1204.5762 L229.5,1204.5762 L229.5,1211.5762 L219.5,1221.5762 L167.5,1221.5762 L167.5,1204.5762 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="823.9844" style="stroke: #000000; stroke-width: 2.0;" width="1464.5" x="167.5" y="1204.5762"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="182.5" y="1218.1445">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87" x="244.5" y="1217.2109">[Hash matched]</text><path d="M187.5,1228.8867 L402.5,1228.8867 L402.5,1235.8867 L392.5,1245.8867 L187.5,1245.8867 L187.5,1228.8867 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="826.5" x="187.5" y="1228.8867"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="202.5" y="1242.4551">Persist Event Information</text><polygon fill="#A80036" points="941.5,1288.5078,951.5,1292.5078,941.5,1296.5078,945.5,1292.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="947.5" y1="1292.5078" y2="1292.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="246" y="1287.7656">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="268" y="1287.7656">Publish event information</text><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="808.5" x="194.5" y="1300.5078"/><polygon fill="#EEEEEE" points="194.5,1300.5078,258.5,1300.5078,258.5,1307.5078,248.5,1317.5078,194.5,1317.5078,194.5,1300.5078" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="207.5" y="1315.0762">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="525.75" y="1334.0762">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="529.75" y="1349.3867"/><polygon fill="#A80036" points="1184,1426.0605,1194,1430.0605,1184,1434.0605,1188,1430.0605" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="1190" y1="1430.0605" y2="1430.0605"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="246" y="1417.6631">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="268" y="1410.0078">Request to retrieve Bulk transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="268" y="1425.3184">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="345" y="1425.3184">2003</text><polygon fill="#A80036" points="1472,1455.3711,1482,1459.3711,1472,1463.3711,1476,1459.3711" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1206" x2="1478" y1="1459.3711" y2="1459.3711"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1213" y="1454.6289">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="1235" y="1454.6289">Request to retrieve Bulk transfer state</text><polygon fill="#FFFFE0" filter="url(#f14gpz4gt9lwd9)" points="1408,1472.3711,1570,1472.3711,1580,1483.3711,1570,1495.3711,1408,1495.3711,1398,1483.3711,1408,1472.3711" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1410" y="1488.9395">bulkTransferStateChange</text><polygon fill="#A80036" points="1217,1517.9922,1207,1521.9922,1217,1525.9922,1213,1521.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1211" x2="1488" y1="1521.9922" y2="1521.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1223" y="1517.25">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="1245" y="1517.25">Return Bulk transfer state</text><polygon fill="#A80036" points="250,1547.3027,240,1551.3027,250,1555.3027,246,1551.3027" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="244" x2="1200" y1="1551.3027" y2="1551.3027"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="256" y="1546.5605">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="278" y="1546.5605">Return Bulk transfer state</text><path d="M177.5,1566.3027 L239.5,1566.3027 L239.5,1573.3027 L229.5,1583.3027 L177.5,1583.3027 L177.5,1566.3027 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="273.75" style="stroke: #000000; stroke-width: 2.0;" width="998.5" x="177.5" y="1566.3027"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="192.5" y="1579.8711">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="284" x="254.5" y="1578.9375">[bulkTransferState IN ['COMPLETED', 'REJECTED']]</text><path d="M187.5,1590.6133 L271.5,1590.6133 L271.5,1597.6133 L261.5,1607.6133 L187.5,1607.6133 L187.5,1590.6133 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="78.2422" style="stroke: #000000; stroke-width: 2.0;" width="978.5" x="187.5" y="1590.6133"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="202.5" y="1604.1816">break</text><rect fill="#FFFFFF" filter="url(#f14gpz4gt9lwd9)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="960.5" x="194.5" y="1607.9238"/><polygon fill="#EEEEEE" points="194.5,1607.9238,258.5,1607.9238,258.5,1614.9238,248.5,1624.9238,194.5,1624.9238,194.5,1607.9238" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="207.5" y="1622.4922">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="555.75" y="1641.4922">Send notification to Participant (Payee)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="559.75" y="1656.8027"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="177.5" x2="1176" y1="1676.8555" y2="1676.8555"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="179" x="182.5" y="1687.4902">[transferState NOT 'ACCEPTED']</text><path d="M187.5,1697.8105 L271.5,1697.8105 L271.5,1704.8105 L261.5,1714.8105 L187.5,1714.8105 L187.5,1697.8105 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="201.5" x="187.5" y="1697.8105"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="202.5" y="1711.3789">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="281" y1="1736.4316" y2="1736.4316"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="281" x2="281" y1="1736.4316" y2="1749.4316"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="281" y1="1749.4316" y2="1749.4316"/><polygon fill="#A80036" points="250,1745.4316,240,1749.4316,250,1753.4316,246,1749.4316" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="246" y="1731.6895">17</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="268" y="1731.6895">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="345" y="1731.6895">2001</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="177.5" x2="1176" y1="1765.4316" y2="1765.4316"/><path d="M187.5,1773.4316 L271.5,1773.4316 L271.5,1780.4316 L261.5,1790.4316 L187.5,1790.4316 L187.5,1773.4316 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="315.5" x="187.5" y="1773.4316"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="202.5" y="1787">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="281" y1="1812.0527" y2="1812.0527"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="281" x2="281" y1="1812.0527" y2="1825.0527"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="281" y1="1825.0527" y2="1825.0527"/><polygon fill="#A80036" points="250,1821.0527,240,1825.0527,250,1829.0527,246,1825.0527" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="246" y="1807.3105">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="268" y="1807.3105">Allow previous request to complete</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="167.5" x2="1632" y1="1848.0527" y2="1848.0527"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="109" x="172.5" y="1858.6875">[Hash not matched]</text><polygon fill="#A80036" points="1184,1894.6289,1194,1898.6289,1184,1902.6289,1188,1898.6289" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="1190" y1="1898.6289" y2="1898.6289"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="246" y="1886.2314">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="268" y="1878.5762">Request to persist transfer hash</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="268" y="1893.8867">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="352" y="1893.8867">2003</text><polygon fill="#A80036" points="1472,1923.9395,1482,1927.9395,1472,1931.9395,1476,1927.9395" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1206" x2="1478" y1="1927.9395" y2="1927.9395"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1213" y="1923.1973">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="1235" y="1923.1973">Persist hash</text><polygon fill="#FFFFE0" filter="url(#f14gpz4gt9lwd9)" points="1365,1970.9395,1612,1970.9395,1622,1981.9395,1612,1993.9395,1365,1993.9395,1355,1981.9395,1365,1970.9395" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="1367" y="1987.5078">bulkTransferFulfilmentDuplicateCheck</text><polygon fill="#A80036" points="250,2016.5605,240,2020.5605,250,2024.5605,246,2020.5605" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="244" x2="1200" y1="2020.5605" y2="2020.5605"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="256" y="2015.8184">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="278" y="2015.8184">Return success</text><path d="M177.5,2049.5605 L239.5,2049.5605 L239.5,2056.5605 L229.5,2066.5605 L177.5,2066.5605 L177.5,2049.5605 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="519.8555" style="stroke: #000000; stroke-width: 2.0;" width="1422.5" x="177.5" y="2049.5605"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="192.5" y="2063.1289">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="223" x="254.5" y="2062.1953">[Validate Bulk Transfer Fulfil (success)]</text><path d="M187.5,2073.8711 L672.5,2073.8711 L672.5,2080.8711 L662.5,2090.8711 L187.5,2090.8711 L187.5,2073.8711 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="214.4844" style="stroke: #000000; stroke-width: 2.0;" width="1402.5" x="187.5" y="2073.8711"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="440" x="202.5" y="2087.4395">Persist Bulk Transfer State (with bulktransferState='PROCESSING')</text><polygon fill="#A80036" points="1184,2123.8027,1194,2127.8027,1184,2131.8027,1188,2127.8027" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="1190" y1="2127.8027" y2="2127.8027"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="246" y="2115.4053">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="268" y="2107.75">Request to persist bulk transfer fulfil</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="268" y="2123.0605">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="352" y="2123.0605">2003</text><polygon fill="#A80036" points="1472,2153.1133,1482,2157.1133,1472,2161.1133,1476,2157.1133" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1206" x2="1478" y1="2157.1133" y2="2157.1133"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1213" y="2152.3711">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="1235" y="2152.3711">Persist bulkTransferFulfilment</text><polygon fill="#FFFFE0" filter="url(#f14gpz4gt9lwd9)" points="1408,2200.1133,1570,2200.1133,1580,2226.1133,1570,2253.1133,1408,2253.1133,1398,2226.1133,1408,2200.1133" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="1410" y="2216.6816">bulkTransferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1410" y="2231.9922">bulkTransferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="1410" y="2247.3027">bulkTransferExtension</text><polygon fill="#A80036" points="250,2276.3555,240,2280.3555,250,2284.3555,246,2280.3555" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="244" x2="1200" y1="2280.3555" y2="2280.3555"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="256" y="2275.6133">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="278" y="2275.6133">Return success</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="177.5" x2="1600" y1="2296.3555" y2="2296.3555"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="217" x="182.5" y="2306.9902">[Validate Bulk Transfer Fulfil (failure)]</text><path d="M187.5,2317.3105 L721.5,2317.3105 L721.5,2324.3105 L711.5,2334.3105 L187.5,2334.3105 L187.5,2317.3105 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="245.1055" style="stroke: #000000; stroke-width: 2.0;" width="1402.5" x="187.5" y="2317.3105"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="489" x="202.5" y="2330.8789">Persist Bulk Transfer State (with bulkTransferState='INVALID/REJECTED')</text><polygon fill="#A80036" points="1184,2382.5527,1194,2386.5527,1184,2390.5527,1188,2386.5527" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="1190" y1="2386.5527" y2="2386.5527"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="246" y="2366.5">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="268" y="2351.1895">Request to persist bulk</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="268" y="2366.5">transfer fulfil failure</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="268" y="2381.8105">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="352" y="2381.8105">2003</text><polygon fill="#A80036" points="1472,2411.8633,1482,2415.8633,1472,2419.8633,1476,2415.8633" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1206" x2="1478" y1="2415.8633" y2="2415.8633"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1213" y="2411.1211">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1235" y="2411.1211">Persist transfer</text><polygon fill="#FFFFE0" filter="url(#f14gpz4gt9lwd9)" points="1408,2458.8633,1570,2458.8633,1580,2492.8633,1570,2527.8633,1408,2527.8633,1398,2492.8633,1408,2458.8633" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="1410" y="2475.4316">bulkTransferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1410" y="2490.7422">bulkTransferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="1410" y="2506.0527">bulkTransferExtension</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="1410" y="2521.3633">bulkTransferError</text><polygon fill="#A80036" points="250,2550.416,240,2554.416,250,2558.416,246,2554.416" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="244" x2="1200" y1="2554.416" y2="2554.416"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="256" y="2549.6738">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="278" y="2549.6738">Return success</text><path d="M167.5,2590.416 L229.5,2590.416 L229.5,2597.416 L219.5,2607.416 L167.5,2607.416 L167.5,2590.416 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1343.0723" style="stroke: #000000; stroke-width: 2.0;" width="1440.5" x="167.5" y="2590.416"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="182.5" y="2603.9844">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="223" x="244.5" y="2603.0508">[Validate Bulk Transfer Fulfil (success)]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="281" y1="2644.3477" y2="2644.3477"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="281" x2="281" y1="2644.3477" y2="2657.3477"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="281" y1="2657.3477" y2="2657.3477"/><polygon fill="#A80036" points="250,2653.3477,240,2657.3477,250,2661.3477,246,2657.3477" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="246" y="2631.9502">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="268" y="2624.2949">Break down the bulk into indidivual transfers</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="268" y="2639.6055">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="352" y="2639.6055">2003</text><path d="M177.5,2672.3477 L251.5,2672.3477 L251.5,2679.3477 L241.5,2689.3477 L177.5,2689.3477 L177.5,2672.3477 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="681.248" style="stroke: #000000; stroke-width: 2.0;" width="1420.5" x="177.5" y="2672.3477"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="192.5" y="2685.916">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="288" x="266.5" y="2684.9824">[for every individual transfer in the bulk fulfil list]</text><path d="M187.5,2696.6582 L739.5,2696.6582 L739.5,2703.6582 L729.5,2713.6582 L187.5,2713.6582 L187.5,2696.6582 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="183.8633" style="stroke: #000000; stroke-width: 2.0;" width="1400.5" x="187.5" y="2696.6582"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="507" x="202.5" y="2710.2266">Update Bulk Transfer Association (with bulkProcessingState='PROCESSING')</text><polygon fill="#A80036" points="1184,2746.5898,1194,2750.5898,1184,2754.5898,1188,2750.5898" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="1190" y1="2750.5898" y2="2750.5898"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="246" y="2738.1924">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="268" y="2730.5371">Request to persist bulk transfer association</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="268" y="2745.8477">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="352" y="2745.8477">2003</text><polygon fill="#A80036" points="1472,2775.9004,1482,2779.9004,1472,2783.9004,1476,2779.9004" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1206" x2="1478" y1="2779.9004" y2="2779.9004"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1213" y="2775.1582">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="1235" y="2775.1582">Update bulkTransferAssociation</text><polygon fill="#FFFFE0" filter="url(#f14gpz4gt9lwd9)" points="1410,2822.9004,1568,2822.9004,1578,2833.9004,1568,2845.9004,1410,2845.9004,1400,2833.9004,1410,2822.9004" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="1412" y="2839.4688">bulkTransferAssociation</text><polygon fill="#A80036" points="250,2868.5215,240,2872.5215,250,2876.5215,246,2872.5215" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="244" x2="1200" y1="2872.5215" y2="2872.5215"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="256" y="2867.7793">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="278" y="2867.7793">Return success</text><path d="M244,2892.5215 L244,3269.5215 L506,3269.5215 L506,2902.5215 L496,2892.5215 L244,2892.5215 " fill="#FFFF00" filter="url(#f14gpz4gt9lwd9)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M496,2892.5215 L496,2902.5215 L506,2902.5215 L496,2892.5215 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="250" y="2910.0898">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="250" y="2925.4004">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="266" y="2940.7109">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="266" y="2956.0215">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="266" y="2971.332">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="266" y="2986.6426">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="266" y="3001.9531">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="282" y="3017.2637">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="282" y="3032.5742">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="266" y="3047.8848">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="266" y="3063.1953">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="282" y="3078.5059">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="298" y="3093.8164">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="298" y="3109.127">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="298" y="3124.4375">type: bulk-fulfil,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="298" y="3139.748">action: fulfil,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="298" y="3155.0586">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="298" y="3170.3691">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="314" y="3185.6797">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="314" y="3200.9902">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="298" y="3216.3008">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="282" y="3231.6113">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="266" y="3246.9219">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="250" y="3262.2324">}</text><polygon fill="#A80036" points="701,3311.5957,711,3315.5957,701,3319.5957,705,3315.5957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="707" y1="3315.5957" y2="3315.5957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="246" y="3303.1982">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="433" x="268" y="3295.543">Route &amp; Publish Prepare event to the Payer for the Individual Transfer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="268" y="3310.8535">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="352" y="3310.8535">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="167.5" x2="1608" y1="3361.5957" y2="3361.5957"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="217" x="172.5" y="3372.2305">[Validate Bulk Transfer Fulfil (failure)]</text><path d="M244,3380.5508 L244,3849.5508 L851,3849.5508 L851,3390.5508 L841,3380.5508 L244,3380.5508 " fill="#FFFF00" filter="url(#f14gpz4gt9lwd9)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M841,3380.5508 L841,3390.5508 L851,3390.5508 L841,3380.5508 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="250" y="3398.1191">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="250" y="3413.4297">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="266" y="3428.7402">id: &lt;bulkTransferMessage.bulkTransferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="266" y="3444.0508">from: &lt;ledgerName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="266" y="3459.3613">to: &lt;bulkTransferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="266" y="3474.6719">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="266" y="3489.9824">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="282" y="3505.293">headers: &lt;bulkTransferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="282" y="3520.6035">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="298" y="3535.9141">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="522" x="314" y="3551.2246">"errorCode": &lt;possible codes: [2003, 3100, 3105, 3106, 3202, 3203, 3300, 3301]&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="392" x="314" y="3566.5352">"errorDescription": "&lt;refer to section 35.1.3 for description&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="314" y="3581.8457">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="282" y="3597.1563">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="266" y="3612.4668">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="266" y="3627.7773">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="282" y="3643.0879">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="298" y="3658.3984">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="298" y="3673.709">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="298" y="3689.0195">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="298" y="3704.3301">action: bulk-abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="298" y="3719.6406">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="298" y="3734.9512">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="314" y="3750.2617">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="314" y="3765.5723">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="314" y="3780.8828">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="298" y="3796.1934">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="282" y="3811.5039">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="266" y="3826.8145">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="250" y="3842.125">}</text><polygon fill="#A80036" points="1068,3891.4883,1078,3895.4883,1068,3899.4883,1072,3895.4883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="1074" y1="3895.4883" y2="3895.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="246" y="3883.0908">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="268" y="3875.4355">Publish Notification (failure) event for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="268" y="3890.7461">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="352" y="3890.7461">2003</text><!--
@startuml
title 2.1.1. Bulk Fulfil Handler Consume

autonumber


collections "topic-bulk-\nfulfil" as TOPIC_BULK_FULFIL
collections "topic-bulk-\nprocessing" as TOPIC_BULK_PROCESSING
control "Bulk Fulfil\nHandler" as BULK_FULF_HANDLER
collections "topic-transfer-\nfulfil" as TOPIC_TRANSFER_FULFIL
collections "topic-event" as TOPIC_EVENTS
collections "topic-notification" as TOPIC_NOTIFICATION
entity "Bulk DAO" as BULK_DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant TOPIC_BULK_FULFIL
    participant BULK_FULF_HANDLER
    participant TOPIC_TRANSFER_FULFIL
    participant TOPIC_BULK_PROCESSING
    participant TOPIC_EVENTS
    participant TOPIC_NOTIFICATION
    participant BULK_DAO
    participant DB
end box

activate BULK_FULF_HANDLER
group Bulk Fulfil Handler Consume
    TOPIC_BULK_FULFIL <- BULK_FULF_HANDLER: Consume message
    activate TOPIC_BULK_FULFIL
    deactivate TOPIC_BULK_FULFIL

    break
        group Validate Event
            BULK_FULF_HANDLER <-> BULK_FULF_HANDLER: Validate event - Rule:\ntype == 'bulk-fulfil' && action == 'bulk-commit'\n<color #FF0000><b>Error codes:</b> 2001</color>
        end
    end

    group Persist Event Information
        |||
        BULK_FULF_HANDLER -> TOPIC_EVENTS: Publish event information
        ref over BULK_FULF_HANDLER, TOPIC_EVENTS:  Event Handler Consume \n
        |||
    end

    group Validate FSPIOP-Signature
        |||
        ref over BULK_FULF_HANDLER, TOPIC_NOTIFICATION: Validate message.content.headers.**FSPIOP-Signature**\n<color #FF0000><b>Error codes:</b> 3105/3106</color>
    end

    group Validate Bulk Fulfil Transfer
        BULK_FULF_HANDLER <-> BULK_FULF_HANDLER: <color #gray>Schema validation of the incoming message</color>
        BULK_FULF_HANDLER <-> BULK_FULF_HANDLER: <color #gray>Verify the message's signature</color>\n<color #gray>(to be confirmed in future requirement)</color>
        note right of BULK_FULF_HANDLER #lightgrey
            The above validation steps are already handled by
            the ML-Adapter for the open source implementation.
            It may need to be added in future for custom adapters.
        end note
        group Validate Bulk Fulfilment Duplicate Check
            BULK_FULF_HANDLER -> BULK_FULF_HANDLER: Generate bulkTransferFulfilmentId UUID
            BULK_FULF_HANDLER -> BULK_DAO: Request to retrieve Bulk transfer\nfulfilment hashes by bulkTransferId\n<color #FF0000><b>Error code:</b> 2003</color>
            activate BULK_DAO
            BULK_DAO -> DB: Request Bulk transfer fulfilment\nduplicate message hashes
            hnote over DB #lightyellow
                SELET transferId, hash
                FROM **bulkTransferFulfilmentDuplicateCheck**
                WHERE bulkTransferId = request.params.id
            end note
            activate DB
            BULK_DAO <- - DB: Return existing hashes
            deactivate DB
            BULK_DAO - -> BULK_FULF_HANDLER: Return <color #red>**(list of)**</color> transfer fulfil message hash(es)
            deactivate BULK_DAO
            BULK_FULF_HANDLER -> BULK_FULF_HANDLER: Loop the list of returned hashes\nand compare each entry with the\ncalculated message hash

            alt Hash matched
                group Persist Event Information
                    |||
                    BULK_FULF_HANDLER -> TOPIC_EVENTS: Publish event information
                    ref over BULK_FULF_HANDLER, TOPIC_EVENTS:  Event Handler Consume\n
                    |||
                end
                BULK_FULF_HANDLER -> BULK_DAO: Request to retrieve Bulk transfer state\n<color #FF0000><b>Error code:</b> 2003</color>
                activate BULK_DAO
                BULK_DAO -> DB: Request to retrieve Bulk transfer state
                hnote over DB #lightyellow
                    bulkTransferStateChange
                end note
                activate DB
                BULK_DAO <- - DB: Return Bulk transfer state
                deactivate DB
                BULK_DAO - -> BULK_FULF_HANDLER: Return Bulk transfer state
                deactivate BULK_DAO
                alt bulkTransferState IN ['COMPLETED', 'REJECTED']
                    break
                        ref over BULK_FULF_HANDLER, TOPIC_NOTIFICATION: Send notification to Participant (Payee)\n
                    end
                else transferState NOT 'ACCEPTED'
                    break
                        BULK_FULF_HANDLER <-> BULK_FULF_HANDLER: <color #FF0000><b>Error code:</b> 2001</color>
                    end
                else
                    break
                        BULK_FULF_HANDLER <-> BULK_FULF_HANDLER: Allow previous request to complete
                    end
                end
            else Hash not matched
                BULK_FULF_HANDLER -> BULK_DAO: Request to persist transfer hash\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate BULK_DAO
                BULK_DAO -> DB: Persist hash
                hnote over DB #lightyellow
                    bulkTransferFulfilmentDuplicateCheck
                end note
                activate DB
                deactivate DB
                BULK_DAO - -> BULK_FULF_HANDLER: Return success
                deactivate BULK_DAO
            end
            
        end
        
        alt Validate Bulk Transfer Fulfil (success)
            group Persist Bulk Transfer State (with bulktransferState='PROCESSING')
                BULK_FULF_HANDLER -> BULK_DAO: Request to persist bulk transfer fulfil\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate BULK_DAO
                BULK_DAO -> DB: Persist bulkTransferFulfilment
                hnote over DB #lightyellow
                    bulkTransferFulfilment
                    bulkTransferStateChange
                    bulkTransferExtension
                end note
                activate DB
                deactivate DB
                BULK_DAO - -> BULK_FULF_HANDLER: Return success
                deactivate BULK_DAO
            end
        else Validate Bulk Transfer Fulfil (failure)
            group Persist Bulk Transfer State (with bulkTransferState='INVALID/REJECTED')
                BULK_FULF_HANDLER -> BULK_DAO: Request to persist bulk\ntransfer fulfil failure\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate BULK_DAO
                BULK_DAO -> DB: Persist transfer
                hnote over DB #lightyellow
                    bulkTransferFulfilment
                    bulkTransferStateChange
                    bulkTransferExtension
                    bulkTransferError
                end note
                activate DB
                deactivate DB
                BULK_DAO - -> BULK_FULF_HANDLER: Return success
                deactivate BULK_DAO
            end
        end

    end
    alt Validate Bulk Transfer Fulfil (success)
        BULK_FULF_HANDLER -> BULK_FULF_HANDLER: Break down the bulk into indidivual transfers\n<color #FF0000><b>Error codes:</b> 2003</color>
        loop for every individual transfer in the bulk fulfil list

            group Update Bulk Transfer Association (with bulkProcessingState='PROCESSING')
                BULK_FULF_HANDLER -> BULK_DAO: Request to persist bulk transfer association\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate BULK_DAO
                BULK_DAO -> DB: Update bulkTransferAssociation
                hnote over DB #lightyellow
                    bulkTransferAssociation
                end note
                activate DB
                deactivate DB
                BULK_DAO - -> BULK_FULF_HANDLER: Return success
                deactivate BULK_DAO
            end

            note right of BULK_FULF_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: bulk-fulfil,
                            action: fulfil,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
            BULK_FULF_HANDLER -> TOPIC_TRANSFER_FULFIL: Route & Publish Prepare event to the Payer for the Individual Transfer\n<color #FF0000><b>Error codes:</b> 2003</color>
            activate TOPIC_TRANSFER_FULFIL
            deactivate TOPIC_TRANSFER_FULFIL
        end
    else Validate Bulk Transfer Fulfil (failure)
        note right of BULK_FULF_HANDLER #yellow
            Message:
            {
                id: <bulkTransferMessage.bulkTransferId>
                from: <ledgerName>,
                to: <bulkTransferMessage.payerFsp>,
                type: application/json
                content: {
                    headers: <bulkTransferHeaders>,
                    payload: {
                        "errorInformation": {
                            "errorCode": <possible codes: [2003, 3100, 3105, 3106, 3202, 3203, 3300, 3301]>
                            "errorDescription": "<refer to section 35.1.3 for description>",
                            "extensionList": <transferMessage.extensionList>
                    }
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: bulk-processing,
                        action: bulk-abort,
                        createdAt: <timestamp>,
                        state: {
                            status: 'error',
                            code: <errorInformation.errorCode>
                            description: <errorInformation.errorDescription>
                        }
                    }
                }
            }
        end note
        BULK_FULF_HANDLER -> TOPIC_NOTIFICATION: Publish Notification (failure) event for Payer\n<color #FF0000><b>Error codes:</b> 2003</color>
        activate TOPIC_NOTIFICATION
        deactivate TOPIC_NOTIFICATION
    end
end
deactivate BULK_FULF_HANDLER
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.14.4
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>